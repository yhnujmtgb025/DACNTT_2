<%- include ("../shares/header") %>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/magnific-popup.js/1.1.0/jquery.magnific-popup.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/magnific-popup.js/1.1.0/magnific-popup.min.css">

    <!-- List user not follow -->


        <main>
          <div class="preview">
              <div data-name="123" id="user-name">
                <%if(name){%>
                    <%=name%>
                <%}else{%>
                    <%=fullname%>
                <%}%>
                <!-- <i class='fas fa-angle-down'></i> -->
              </div>
         
              <%if(following.length > 0){%>
                  <% following.forEach(function(following) {%>
                    <div class="user-following " id="user-following-<%=following._id%>">
                      <span class="pic-div">
                        <img id="pic" src="<%=following.profileImage%>">
                      </span>
                      <div class="chat-username">
                        <a href="#" class="name" onclick="directPerson(this, '<%=following._id%>','<%=following.idFollowing%>' ,'<%=following.profileImage%>','<%=following.fullname%>','<%=id_current%>')"> 
                          <span >
                            <%=following.fullname%>
                          </span>
                        </a>
                        <span class="msg">Following</span>
                      </div>
                  </div>
                  <%})%>
              <%}%>
        
        
          </div>

            <div class="chats">
              
                <div class="sticky-top chat-banner">
                    <div>
                      <span class="chat-pic"> 
                        <img class="pic" id="pic" src="<%=image%>"  style="margin-bottom: 0.5rem;" />
                      </span>
                      <a href="#"  style="margin-left:5px;cursor: pointer; text-decoration: none; color: #333;">
                        <span id="name-selected">
                          <%if(name){%>
                            <%=name%>
                          <%}else{%>
                              <%=fullname%>
                          <%}%>
                          </span>
                        </a>
                    </div>
                </div>
                <div class="frame-chat">
                  
                  <div class="image-message">
                      <svg id="Capa_1" enable-background="new 0 0 512.004 512.004" height="100" viewBox="0 0 512.004 512.004" width="100" xmlns="http://www.w3.org/2000/svg"><g><path d="m511.35 52.881-122 400c-3.044 9.919-14.974 13.828-23.29 7.67-7.717-5.727-203.749-151.217-214.37-159.1l-142.1-54.96c-5.79-2.24-9.6-7.81-9.59-14.02.01-6.21 3.85-11.77 9.65-13.98l482-184c5.824-2.232 12.488-.626 16.67 4.17 3.37 3.87 4.55 9.24 3.03 14.22z" fill="#94dfda"/><path d="m511.35 52.881-122 400c-3.044 9.919-14.974 13.828-23.29 7.67l-190.05-141.05 332.31-280.84c3.37 3.87 4.55 9.24 3.03 14.22z" fill="#61a7c5"/><path d="m507.89 58.821-271.49 286.4-63 125.03c-3.16 6.246-10.188 9.453-16.87 7.84-6.76-1.6-11.53-7.64-11.53-14.59v-175.3c0-4.86 2.35-9.41 6.31-12.23l337-239.69c6.29-4.48 14.95-3.45 20.01 2.38 5.07 5.83 4.88 14.56-.43 20.16z" fill="#eef4ff"/><path d="m507.89 58.821-271.49 286.4-63 125.03c-3.16 6.246-10.188 9.453-16.87 7.84-6.76-1.6-11.53-7.64-11.53-14.59l31.01-144 332.31-280.84c5.07 5.83 4.88 14.56-.43 20.16z" fill="#d9e6fc"/></g></svg>
                      <p>Your message</p>
                  </div>
                  <!-- <div class="receiver" id="receiver-1">
                      <div class="box-msg">
                          <div class="attach-img">
                            <div class="edit-img">
                              <svg class="dot-img-brown img-brown-1" aria-label="Unsend"  fill="#8e8e8e" height="16" role="img" viewBox="0 0 48 48" width="16">
                                <circle clip-rule="evenodd" cx="8" cy="24" fill-rule="evenodd" r="4.5"></circle>
                                <circle clip-rule="evenodd" cx="24" cy="24" fill-rule="evenodd" r="4.5"></circle>
                                <circle clip-rule="evenodd" cx="40" cy="24" fill-rule="evenodd" r="4.5"></circle>
                              </svg>
                              <svg class="dot-img-black img-black-1" aria-label="Unsend"  fill="#262626" height="16" role="img" viewBox="0 0 48 48" width="16">
                                <circle clip-rule="evenodd" cx="8" cy="24" fill-rule="evenodd" r="4.5"></circle>
                                <circle clip-rule="evenodd" cx="24" cy="24" fill-rule="evenodd" r="4.5"></circle>
                                <circle clip-rule="evenodd" cx="40" cy="24" fill-rule="evenodd" r="4.5"></circle>
                              </svg>
                              <div class="modal-edit-img modal-img-1">
                                <p>Like</p>
                                <p>Unsend</p>
                                <img src="img/tamgiac.png" alt="">
                              </div>
                            </div>
                            <div class="img-msg">
                                  <div class="inner-width">
                                    <div class="gallery">
                                     <a href="img/2.png" class="image">
                                        <img src="img/2.png" alt="">
                                      </a>
                                      <a href="img/3.png" class="image">
                                        <img src="img/3.png" alt="">
                                      </a>
                                      
                                    </div>
                                  </div>
                                  <div class="heart-img">
                                    ❤️
                                  </div>
                            </div>
                          </div>
                          <div class="attach-vid">
                            <div class="edit-vid">
                              <svg class="dot-vid-brown vid-brown-1" aria-label="Unsend"  fill="#8e8e8e" height="16" role="img" viewBox="0 0 48 48" width="16">
                                <circle clip-rule="evenodd" cx="8" cy="24" fill-rule="evenodd" r="4.5"></circle>
                                <circle clip-rule="evenodd" cx="24" cy="24" fill-rule="evenodd" r="4.5"></circle>
                                <circle clip-rule="evenodd" cx="40" cy="24" fill-rule="evenodd" r="4.5"></circle>
                              </svg>
                              <svg class="dot-vid-black vid-black-1" aria-label="Unsend"  fill="#262626" height="16" role="img" viewBox="0 0 48 48" width="16">
                                <circle clip-rule="evenodd" cx="8" cy="24" fill-rule="evenodd" r="4.5"></circle>
                                <circle clip-rule="evenodd" cx="24" cy="24" fill-rule="evenodd" r="4.5"></circle>
                                <circle clip-rule="evenodd" cx="40" cy="24" fill-rule="evenodd" r="4.5"></circle>
                              </svg>
                              <div class="modal-edit-vid modal-vid-1">
                                <p>Like</p>
                                <p>Unsend</p>
                                <img src="img/tamgiac.png" alt="">
                            </div>
                            </div>
                            <a href="video/a.mp4" class="video-msg">
                              <iframe src="video/a.mp4" frameborder="0" sandbox></iframe>
                              <div class="heart-vid">
                                ❤️
                              </div>
                            </a>
                          </div>
                          <div class="content-msg">
                              <div class="edit-msg">
                                <div class="modal-edit-msg modal-msg-1">
                                  <p>Like</p>
                                  <p>Unsend</p>
                                  <img src="img/tamgiac.png" alt="">
                                </div>
                                  <svg class="dot-msg-brown msg-brown-1" aria-label="Unsend"  fill="#8e8e8e" height="16" role="img" viewBox="0 0 48 48" width="16">
                                    <circle clip-rule="evenodd" cx="8" cy="24" fill-rule="evenodd" r="4.5"></circle>
                                    <circle clip-rule="evenodd" cx="24" cy="24" fill-rule="evenodd" r="4.5"></circle>
                                    <circle clip-rule="evenodd" cx="40" cy="24" fill-rule="evenodd" r="4.5"></circle>
                                  </svg>
                                  <svg class="dot-msg-black msg-black-1" aria-label="Unsend"  fill="#262626" height="16" role="img" viewBox="0 0 48 48" width="16">
                                    <circle clip-rule="evenodd" cx="8" cy="24" fill-rule="evenodd" r="4.5"></circle>
                                    <circle clip-rule="evenodd" cx="24" cy="24" fill-rule="evenodd" r="4.5"></circle>
                                    <circle clip-rule="evenodd" cx="40" cy="24" fill-rule="evenodd" r="4.5"></circle>
                                  </svg>                                
                              </div>
                                <div class="text-msg">
                                    lorem10
                                    <div class="heart-msg">
                                      ❤️
                                    </div>
                              </div>
                          </div>
                      </div>
                  </div> -->

                  <!-- <div class="sender" id="sender-1">
                    <div class="box-msg">
                      <div class="attach-img">
                        <div class="edit-img">
                          <div class="img-msg">
                            <div class="inner-width">
                              <div class="gallery">
                               <a href="img/2.png" class="image">
                                  <img src="img/2.png" alt="">
                                </a>
                                <a href="img/3.png" class="image">
                                  <img src="img/3.png" alt="">
                                </a>
                                <a href="img/4.png" class="image">
                                  <img src="img/4.png" alt="">
                                </a>
                             
                              </div>
                            </div>
                            <div class="heart-img">
                              ❤️
                            </div>
                      </div>
                          <svg class="dot-img-brown img-brown-2" aria-label="Unsend"  fill="#8e8e8e" height="16" role="img" viewBox="0 0 48 48" width="16">
                            <circle clip-rule="evenodd" cx="8" cy="24" fill-rule="evenodd" r="4.5"></circle>
                            <circle clip-rule="evenodd" cx="24" cy="24" fill-rule="evenodd" r="4.5"></circle>
                            <circle clip-rule="evenodd" cx="40" cy="24" fill-rule="evenodd" r="4.5"></circle>
                          </svg>
                          <svg class="dot-img-black img-black-2" aria-label="Unsend"  fill="#262626" height="16" role="img" viewBox="0 0 48 48" width="16">
                            <circle clip-rule="evenodd" cx="8" cy="24" fill-rule="evenodd" r="4.5"></circle>
                            <circle clip-rule="evenodd" cx="24" cy="24" fill-rule="evenodd" r="4.5"></circle>
                            <circle clip-rule="evenodd" cx="40" cy="24" fill-rule="evenodd" r="4.5"></circle>
                          </svg>
                          <div class="modal-edit-img modal-img-2">
                            <p>Like</p>
                            <p>Unsend</p>
                            <img src="img/tamgiac.png" alt="">
                          </div>
                        </div>
                      
                      </div>
                      <div class="attach-vid">
                        <div class="edit-vid">
                          <a href="video/a.mp4" class="video-msg">
                            <iframe src="video/a.mp4" frameborder="0" sandbox></iframe>
                            <div class="heart-vid">
                              ❤️
                            </div>
                          </a>
                            <svg class="dot-vid-brown vid-brown-2" aria-label="Unsend"  fill="#8e8e8e" height="16" role="img" viewBox="0 0 48 48" width="16">
                              <circle clip-rule="evenodd" cx="8" cy="24" fill-rule="evenodd" r="4.5"></circle>
                              <circle clip-rule="evenodd" cx="24" cy="24" fill-rule="evenodd" r="4.5"></circle>
                              <circle clip-rule="evenodd" cx="40" cy="24" fill-rule="evenodd" r="4.5"></circle>
                            </svg>
                            <svg class="dot-vid-black vid-black-2" aria-label="Unsend"  fill="#262626" height="16" role="img" viewBox="0 0 48 48" width="16">
                              <circle clip-rule="evenodd" cx="8" cy="24" fill-rule="evenodd" r="4.5"></circle>
                              <circle clip-rule="evenodd" cx="24" cy="24" fill-rule="evenodd" r="4.5"></circle>
                              <circle clip-rule="evenodd" cx="40" cy="24" fill-rule="evenodd" r="4.5"></circle>
                            </svg>
                            <div class="modal-edit-vid modal-vid-2">
                              <p>Like</p>
                              <p>Unsend</p>
                              <img src="img/tamgiac.png" alt="">
                            </div>
                        </div>
                      </div>
                      <div class="content-msg">
                            <div class="text-msg">
                                lorem10
                                <div class="heart-msg">
                                  ❤️
                                </div>
                            </div>
                            <div class="edit-msg">
                                <svg class="dot-msg-brown msg-brown-2" aria-label="Unsend"  fill="#8e8e8e" height="16" role="img" viewBox="0 0 48 48" width="16">
                                  <circle clip-rule="evenodd" cx="8" cy="24" fill-rule="evenodd" r="4.5"></circle>
                                  <circle clip-rule="evenodd" cx="24" cy="24" fill-rule="evenodd" r="4.5"></circle>
                                  <circle clip-rule="evenodd" cx="40" cy="24" fill-rule="evenodd" r="4.5"></circle>
                                </svg>
                                <svg class="dot-msg-black msg-black-2" aria-label="Unsend"  fill="#262626" height="16" role="img" viewBox="0 0 48 48" width="16">
                                  <circle clip-rule="evenodd" cx="8" cy="24" fill-rule="evenodd" r="4.5"></circle>
                                  <circle clip-rule="evenodd" cx="24" cy="24" fill-rule="evenodd" r="4.5"></circle>
                                  <circle clip-rule="evenodd" cx="40" cy="24" fill-rule="evenodd" r="4.5"></circle>
                                </svg>   
                                <div class="modal-edit-msg modal-msg-2">
                                  <p>Like</p>
                                  <p>Unsend</p>
                                  <img src="img/tamgiac.png" alt="">
                                </div>                             
                            </div>
                      </div>
                    </div>
                  </div> -->
              
                </div>
            
            
            
              <div class="user-input " ></div>
         
              <div class="inputFlex ">
               
                <div class="input-msg">
                  <div class="gallery-section">
                    <div class="inner-width">
                      <div class="gallery pre-img" id="pre-img">

                          <!-- <a href="img/1.png" class="image ">
                            <img src="img/1.png" alt="">
                              <div class="co-remove">
                                <span class="re-image" id="span-' + index + '" onclick="removeImage('+index+')">
                                    &#x2715
                                </span>
                              </div>
                          </a> -->
                
                          
                      </div>
                      <div class="gallery pre-vid" id="pre-vid">
                        <!-- <a href="video/a.mp4" class="image">
                          <video controls>
                            <source src="video/a.mp4" type="video/mp4">
                          </video>
                          <div class="co-remove">
                            <span class="re-image" id="span-' + index + '" onclick="removeImage('+index+')">
                                &#x2715
                            </span>
                          </div>
                        </a> -->
                       
                        
                       
                      </div>
                    </div>
                  </div>


                  <form id="post-message" onsubmit="return sendMessageFriends(this)">
                    
                      <button class="btnSmile" type="button" >
                        <div class="btnCover" >
                          <svg aria-label="Emoji" class="faSmile" fill="#262626" height="25" viewBox="0 0 48 48" width="25">
                            <path d="M24 48C10.8 48 0 37.2 0 24S10.8 0 24 0s24 10.8 24 24-10.8 24-24 24zm0-45C12.4 3 3 12.4 3 24s9.4 21 21 21 21-9.4 21-21S35.6 3 24 3z"></path>
                            <path d="M34.9 24c0-1.4-1.1-2.5-2.5-2.5s-2.5 1.1-2.5 2.5 1.1 2.5 2.5 2.5 2.5-1.1 2.5-2.5zm-21.8 0c0-1.4 1.1-2.5 2.5-2.5s2.5 1.1 2.5 2.5-1.1 2.5-2.5 2.5-2.5-1.1-2.5-2.5zM24 37.3c-5.2 0-8-3.5-8.2-3.7-.5-.6-.4-1.6.2-2.1.6-.5 1.6-.4 2.1.2.1.1 2.1 2.5 5.8 2.5 3.7 0 5.8-2.5 5.8-2.5.5-.6 1.5-.7 2.1-.2.6.5.7 1.5.2 2.1 0 .2-2.8 3.7-8 3.7z"></path>
                          </svg>
                        </div>
                      </button>

                      <input type="hidden" id="id-follow" name="id_follow" value="">
                      <input type="hidden" id="_id" name="_id" value="">
                    
                     <input type="text" name="message" class="send-input" id="msg-enter" placeholder="Message..." autocomplete="off">

                    
                     
                      <a href="#" style=" cursor: pointer; display: flex;">
                          <button type="submit">
                          </button>
                            <label class="fileContainer" style=" cursor: pointer;">
                              <svg id="_x31_" enable-background="new 0 0 24 24" height="24"
                                  viewBox="0 0 24 24" width="24">
                                  <g>
                                      <path
                                          d="m17.453 24c-.168 0-.34-.021-.51-.066l-15.463-4.141c-1.06-.292-1.692-1.39-1.414-2.45l1.951-7.272c.072-.267.346-.422.612-.354.267.071.425.346.354.612l-1.95 7.27c-.139.53.179 1.082.71 1.229l15.457 4.139c.531.14 1.079-.176 1.217-.704l.781-2.894c.072-.267.346-.426.613-.353.267.072.424.347.353.613l-.78 2.89c-.235.89-1.045 1.481-1.931 1.481z" />
                                  </g>
                                  <g>
                                      <path
                                          d="m22 18h-16c-1.103 0-2-.897-2-2v-12c0-1.103.897-2 2-2h16c1.103 0 2 .897 2 2v12c0 1.103-.897 2-2 2zm-16-15c-.551 0-1 .449-1 1v12c0 .551.449 1 1 1h16c.551 0 1-.449 1-1v-12c0-.551-.449-1-1-1z" />
                                  </g>
                                  <g>
                                      <path
                                          d="m9 9c-1.103 0-2-.897-2-2s.897-2 2-2 2 .897 2 2-.897 2-2 2zm0-3c-.551 0-1 .449-1 1s.449 1 1 1 1-.449 1-1-.449-1-1-1z" />
                                  </g>
                                  <g>
                                      <path
                                          d="m4.57 16.93c-.128 0-.256-.049-.354-.146-.195-.195-.195-.512 0-.707l4.723-4.723c.566-.566 1.555-.566 2.121 0l1.406 1.406 3.892-4.67c.283-.339.699-.536 1.142-.54h.011c.438 0 .853.19 1.139.523l5.23 6.102c.18.209.156.525-.054.705-.209.18-.524.157-.705-.054l-5.23-6.102c-.097-.112-.231-.174-.38-.174-.104-.009-.287.063-.384.18l-4.243 5.091c-.09.108-.221.173-.362.179-.142.01-.277-.046-.376-.146l-1.793-1.793c-.189-.188-.518-.188-.707 0l-4.723 4.723c-.097.097-.225.146-.353.146z" />
                                  </g>
                              </svg>
                              <input type="file" name="image" accept="image/*" class="upload-photo" id="file_msg"
                                  multiple onchange="previewSendImage()">
                          </label>
                          
                          <label class="fileVideo" style="margin-left: 0.5rem;cursor: pointer;">
                            <svg height="24" viewBox="0 -87 472 472" width="24">
                                <path
                                    d="m467.101562 26.527344c-3.039062-1.800782-6.796874-1.871094-9.898437-.179688l-108.296875 59.132813v-35.480469c-.03125-27.601562-22.398438-49.96875-50-50h-248.90625c-27.601562.03125-49.96875 22.398438-50 50v197.421875c.03125 27.601563 22.398438 49.96875 50 50h248.90625c27.601562-.03125 49.96875-22.398437 50-50v-34.835937l108.300781 59.132812c3.097657 1.691406 6.859375 1.625 9.894531-.175781 3.039063-1.804688 4.898438-5.074219 4.898438-8.601563v-227.816406c0-3.53125-1.863281-6.796875-4.898438-8.597656zm-138.203124 220.898437c-.015626 16.5625-13.4375 29.980469-30 30h-248.898438c-16.5625-.019531-29.980469-13.4375-30-30v-197.425781c.019531-16.558594 13.4375-29.980469 30-30h248.90625c16.558594.019531 29.980469 13.441406 30 30zm123.101562-1.335937-103.09375-56.289063v-81.535156l103.09375-56.285156zm0 0" />
                            </svg>
                            <input type="file" name="video" accept="video/*" class="upload-photo"
                                id="fileVideo_msg" onchange="previewSendVideo()">
                        </label>
                          <!-- <svg aria-label="Direct" class="_8-yf5 "  height="30" viewBox="0 0 48 48" width="30">
                              <path
                              id="#" d="M47.8 3.8c-.3-.5-.8-.8-1.3-.8h-45C.9 3.1.3 3.5.1 4S0 5.2.4 5.7l15.9 15.6 5.5 22.6c.1.6.6 1 1.2 1.1h.2c.5 0 1-.3 1.3-.7l23.2-39c.4-.4.4-1 .1-1.5zM5.2 6.1h35.5L18 18.7 5.2 6.1zm18.7 33.6l-4.4-18.4L42.4 8.6 23.9 39.7z">
                              </path>
                          </svg> -->
                       
                      </a>
                    </form>
              </div>
       
              </div>
            
          
            </div>
        
        </main>

<script src="/socket.io/socket.io.js"></script>
<script>
  
  var socket= io();
  var sender = ''
  $(".inputFlex").css('display','none')

  // receiver
  function hoverReceiver(id){
    // image
    $( "#receiver-"+id+" "+".attach-img" ).hover(
    function() {
      $(".img-brown-"+id).css("display","block")
      $( ".img-brown-"+id ).hover(
      function() {
        $(".img-black-"+id).css("display","block")
        $(".img-brown-"+id).css("display","none")
      }, function() {
        $(".img-black-"+id).css("display","block")
        $(".img-black-"+id).click(function(){
          $(".img-black-"+id).css("display","block")
          $(".modal-img-"+id).css("visibility","visible")
        })
      }
    );
    }, function() {
      $(".img-brown-"+id).css("display","none")
      $(".img-black-"+id).css("display","none")
      $(".modal-img-"+id).css("visibility","hidden")
    }
  );
    // video
    $(  "#receiver-"+id+" "+".attach-vid" ).hover(
    function() {
      $(".vid-brown-"+id).css("display","block")
      $( ".vid-brown-"+id ).hover(
      function() {
        $(".vid-black-"+id).css("display","block")
        $(".vid-brown-"+id).css("display","none")
      }, function() {
        $(".vid-black-"+id).css("display","block")
        $(".vid-black-"+id).click(function(){
          $(".vid-black-"+id).css("display","block")
          $(".modal-vid-"+id).css("visibility","visible")
        })
      }
    );
    }, function() {
      $(".vid-brown-"+id).css("display","none")
      $(".vid-black-"+id).css("display","none")
      $(".modal-vid-"+id).css("visibility","hidden")
    }
  );
    // message
    $( "#receiver-"+id+" "+".content-msg" ).hover(
    function() {
      $(".msg-brown-"+id).css("display","block")
      $( ".msg-brown-"+id ).hover(
      function() {
        $(".msg-black-"+id).css("display","block")
        $(".msg-brown-"+id).css("display","none")
      }, function() {
        $(".msg-black-"+id).css("display","block")
        $(".msg-black-"+id).click(function(){
          $(".msg-black-"+id).css("display","block")
          $(".modal-msg-"+id).css("visibility","visible")
        })
      }
    );
    }, function() {
      $(".msg-brown-"+id).css("display","none")
      $(".msg-black-"+id).css("display","none")
      $(".modal-msg-"+id).css("visibility","hidden")
    }
  );
    
    $('#receiver-'+id).magnificPopup({
      delegate: 'a',
      type: 'image',
      tLoading: 'Loading image #%curr%...',
      mainClass: 'mfp-img-mobile',
      gallery: {
        enabled: true,
        navigateByImgClick: true,
        preload: [0,1] // Will preload 0 - before current, and 1 after the current image
      },
      image: {
        tError: '<a href="%url%">The image #%curr%</a> could not be loaded.'
      },
      callbacks: {
        elementParse: function(item) {
          console.log(item.src)
          var a =item.src.toString().split("/")[0]
          //  the class name
          if(a == 'demo') {
            item.type = 'iframe';
          } else {
            item.type = 'image';
          }
    }
      },
  });


  }
 
  // sender
  function hoverSender(id){
    $( "#sender-"+id+" "+".attach-img" ).hover(
    function() {
      $(".img-brown-"+id).css("display","block")
      $( ".img-brown-"+id ).hover(
      function() {
        $(".img-black-"+id).css("display","block")
        $(".img-brown-"+id).css("display","none")
      }, function() {
        $(".img-black-"+id).css("display","block")
        $(".img-black-"+id).click(function(){
          $(".img-black-"+id).css("display","block")
          $(".modal-img-"+id).css("visibility","visible")
        })
      }
    );
    }, function() {
      $(".img-brown-"+id).css("display","none")
      $(".img-black-"+id).css("display","none")
      $(".modal-img-"+id).css("visibility","hidden")
    }
  );
    
  $( "#sender-"+id+" "+".attach-vid"  ).hover(
    function() {
      $(".vid-brown-"+id).css("display","block")
      $( ".vid-brown-"+id ).hover(
      function() {
        $(".vid-black-"+id).css("display","block")
        $(".vid-brown-"+id).css("display","none")
      }, function() {
        $(".vid-black-"+id).css("display","block")
        $(".vid-black-"+id).click(function(){
          $(".vid-black-"+id).css("display","block")
          $(".modal-vid-"+id).css("visibility","visible")
        })
      }
    );
    }, function() {
      $(".vid-brown-"+id).css("display","none")
      $(".vid-black-"+id).css("display","none")
      $(".modal-vid-"+id).css("visibility","hidden")
    }
  );

  $(  "#sender-"+id+" "+".content-msg" ).hover(
    function() {
      $(".msg-brown-"+id).css("display","block")
      $( ".msg-brown-"+id ).hover(
      function() {
        $(".msg-black-"+id).css("display","block")
        $(".msg-brown-"+id).css("display","none")
      }, function() {
        $(".msg-black-"+id).css("display","block")
        $(".msg-black-"+id).click(function(){
          $(".msg-black-"+id).css("display","block")
          $(".modal-msg-"+id).css("visibility","visible")
        })
      }
    );
    }, function() {
      $(".msg-brown-"+id).css("display","none")
      $(".msg-black-"+id).css("display","none")
      $(".modal-msg-"+id).css("visibility","hidden")
    }
  );
    
  $('#sender-'+id).magnificPopup({
      delegate: 'a',
      type: 'image',
      tLoading: 'Loading image #%curr%...',
      mainClass: 'mfp-img-mobile',
      gallery: {
        enabled: true,
        navigateByImgClick: true,
        preload: [0,1] // Will preload 0 - before current, and 1 after the current image
      },
      image: {
        tError: '<a href="%url%">The image #%curr%</a> could not be loaded.',
        /*titleSrc: function(item) {
          return item.el.attr('title') + '<small>by Marsel Van Oosten</small>';
        }*/
      },
      callbacks: {
        elementParse: function(item) {
          var a =item.src.toString().split("/")[0]
          //  the class name
          if(a == 'video') {
            item.type = 'iframe';
          } else {
            item.type = 'image';
          }
    }
      },
  });


  }
 
      // preview image before send
      var stored_img = [];
      var arr_img = ''
      var html_msg = ""
      function previewSendImage() {
          var input = document.getElementById('file_msg');
          var output = document.getElementById('pre-img');
      
          arr_img=  Array.prototype.slice.call(input.files); 
          
          if($(".check-image").hasClass("image-tag")){
              html_msg=''
          }
          for (var i = 0; i < arr_img.length; ++i) {
            stored_img.push(arr_img[i])
          }
          for(var i = 0; i< stored_img.length;i++){
              (function (index) {
              var fileReader = new FileReader();
                      fileReader.onload = function (event) {
                        html_msg += '<a href="' + event.target.result + '" class="image image-tag check-image remove-img-'+index+'">'
                          html_msg += '<img src="' + event.target.result + '" alt="">'
                            html_msg += '<div class="co-remove">'
                              html_msg += '<span class="re-image" id="span-' + index + '" onclick="removeImage_Msg('+index+')">'
                              html_msg += ' &#x2715</span>'
                            html_msg += '</div>'
                        html_msg += '</a>'
                        output.innerHTML = html_msg; 
                      };
                      fileReader.readAsDataURL(stored_img[i]);
                  })(i);
              }
      }
          
      function removeImage_Msg(n) {
          $(".remove-img-" + n).remove();
          stored_img.splice(n,1);
      }  
         
      // preview image before send
      var stored_vid = [];
      var arr_vid = ''
      var vid_msg = ""
      function previewSendVideo() {
          var input = document.getElementById('fileVideo_msg');
          var output = document.getElementById('pre-vid');
      
          arr_vid=  Array.prototype.slice.call(input.files); 
          
          if($(".check-video").hasClass("video-tag")){
            vid_msg=''
          }
          for (var i = 0; i < arr_vid.length; ++i) {
            stored_vid.push(arr_vid[i])
          }
          for(var i = 0; i< stored_vid.length;i++){
              (function (index) {
              var fileReader = new FileReader();
                      fileReader.onload = function (event) {
                        vid_msg += '<a href="' + event.target.result + '" class="image video-tag check-video remove-vid-'+index+'">'
                          vid_msg += '<video controls >'
                            vid_msg += '  <source src="' + event.target.result + '" type="video/mp4">'
                          vid_msg += '</video>'
                            vid_msg += '<div class="co-remove">'
                              vid_msg += '<span class="re-image" id="span-' + index + '" onclick="removeVideo_Msg('+index+')">'
                              vid_msg += ' &#x2715</span>'
                            vid_msg += '</div>'
                          vid_msg += '</a>'
                        output.innerHTML = vid_msg; 
                      };
                      fileReader.readAsDataURL(stored_vid[i]);
                  })(i);
              }
      }
          
      function removeVideo_Msg(n) {
          $(".remove-vid-" + n).remove();
          stored_vid.splice(n,1);
      }  
         


  function directPerson(self,id,id_follow,image,name,id_current){
      $("img.pic").attr("src",image)
      $("#name-selected").text(name)
      $("#_id").val(id)
      $("#id-follow").val(id_follow)
      $(".inputFlex").css('display','block')
      $(".framechat").css('display','none')
      socket.emit("message",{id_current:id_current})
      getMessage(id_follow);
  }
  var id_hover = ''
  function getMessage(id){
    $.ajax({
            method: "POST",
            url: "/getInbox",
            data: {
                _id: id   // id following
            },
            cache: false,
            success: function (responseText) {
                if (responseText.status == "success") {  
                    var html =""
                    user = responseText.user[0]
                    for(var i= 0;i < user.followings.length;i++){
                      var follow = user.followings[i]
                      if(follow.idFollowing.toString() == id.toString()){
                          for(var j = 0; j < follow.inbox.length ; j++){
                              var inbox = follow.inbox[j]
                              if(inbox.from.toString() ==  responseText.id.toString())
                              {
                                  html += '<div class="receiver" id="receiver-'+inbox._id+'">'
                                    html += '<div class="box-msg">'
                                        if(inbox.image[1].length > 0){
                                              html += '<div class="attach-img">'
                                                  html += '<div class="edit-img">'
                                                    html += '<div class="img-msg">'
                                                        html += '<div class="inner-width">'
                                                            html += '<div class="gallery">'
                                                                for(var n =0 ; n < inbox.image[1].length; n++){
                                                                    var image = inbox.image[1]
                                                                    html += '<a href="/demo/' + image[n].originalname + ' " class="image">'
                                                                      html += '<img src="/demo/' + image[n].originalname + ' " alt="">'
                                                                    html += '</a>'
                                                                  }                                                       
                                                            html += '</div>'
                                                        html += '</div>'
                                                        if(inbox.image[0].length > 0){
                                                            if(inbox.image[0].length > 1){
                                                              html += ' <div style="visibility:visible" class="heart-img heart-img-'+inbox._id+'">'
                                                                html += '<span>'
                                                                  html += inbox.image[0].length 
                                                                html += '</span>'
                                                                html += '<span>'
                                                                html += '❤️</span>'
                                                              html += '</div>'
                                                            }else{
                                                              for(var i =0 ; i < inbox.image[0].length;i++){
                                                                 var likeImage = inbox.image[0]
                                                                  if(likeImage[i].from.toString() == user._id.toString()){
                                                                    html += ' <div style="visibility:visible" class="heart-img heart-img-'+inbox._id+'">'
                                                                      html += '❤️'
                                                                    html += '</div>'
                                                                  }else{
                                                                    html += ' <div style="visibility:visible" class="heart-img heart-img-'+inbox._id+'">'
                                                                      html += '	&#128153'
                                                                    html += '</div>'
                                                                  }
                                                              }
                                                              
                                                            }
                                                     
                                                  }
                                                
                                                    html += '</div>'
                                                      html += '<svg class="dot-img-brown img-brown-'+inbox._id+'" aria-label="Unsend"  fill="#8e8e8e" height="16" role="img" viewBox="0 0 48 48" width="16">'
                                                          html += '<circle clip-rule="evenodd" cx="8" cy="24" fill-rule="evenodd" r="4.5">'
                                                          html += '</circle>'
                                                          html += '<circle clip-rule="evenodd" cx="24" cy="24" fill-rule="evenodd" r="4.5">'
                                                          html += '</circle>'
                                                          html += '<circle clip-rule="evenodd" cx="40" cy="24" fill-rule="evenodd" r="4.5">'
                                                          html += '</circle>'
                                                          html += '</svg>'
                                                      html += '<svg class="dot-img-black img-black-'+inbox._id+'" aria-label="Unsend"  fill="#262626" height="16" role="img" viewBox="0 0 48 48" width="16">'
                                                          html += '<circle clip-rule="evenodd" cx="8" cy="24" fill-rule="evenodd" r="4.5">'
                                                          html += '</circle>'
                                                          html += '<circle clip-rule="evenodd" cx="24" cy="24" fill-rule="evenodd" r="4.5">'
                                                          html += '</circle>'
                                                          html += '<circle clip-rule="evenodd" cx="40" cy="24" fill-rule="evenodd" r="4.5">'
                                                          html += '</circle>'
                                                      html += '</svg>'
                                                  html += '<div class="modal-edit-img modal-img-'+inbox._id+'">'
                                                    var islike_img_receiver = false
                                                    var id_created_img_receiver = ''
                                                    if(inbox.image[0].length > 0){
                                                      for(var i =0 ; i < inbox.image[0].length;i++){
                                                        var likeImage = inbox.image[0]
                                                        if(likeImage[i].from.toString() == user._id.toString()){
                                                            islike_img_receiver = true
                                                            id_created_img_receiver = likeImage[i].createdAt
                                                            break;
                                                        }
                                                      }
                                                    }
                                                    if(islike_img_receiver){
                                                      html += '<p class="unlike-img" onclick="like_Msg('+"'"+"image"+"'"+","+"'"+inbox._id+"'"+","+"'"+id+"'"+","+"'"+inbox.createdAt+"'"+","+"'"+id_created_img_receiver+"'"+')">'
                                                          html += 'Unlike&nbsp;'
                                                      html += '</p>'
                                                      html += '<p onclick="unsend_Msg('+"'"+"image"+"'"+","+"'"+inbox._id+"'"+","+"'"+id+"'"+","+"'"+inbox.createdAt+"'"+')">Unsend'
                                                      html += '</p>'
                                                      html += '<img class="img-unlike" src="img/tamgiac.png" alt="">'
                                                    }
                                                    else{
                                                      html += '<p class="unlike-img-0" onclick="like_Msg('+"'"+"image"+"'"+","+"'"+inbox._id+"'"+","+"'"+id+"'"+","+"'"+inbox.createdAt+"'"+')">'
                                                        html += 'Like'
                                                      html += '</p>'
                                                      html += '<p onclick="unsend_Msg('+"'"+"image"+"'"+","+"'"+inbox._id+"'"+","+"'"+id+"'"+","+"'"+inbox.createdAt+"'"+')">Unsend'
                                                      html += '</p>'
                                                      html += '<img class="img-like" src="img/tamgiac.png" alt="">'
                                                    }
                                                
                                                  html += '</div>'
                                              html += '</div>'
                                         
                                          html += '</div>'
                                    }
                                        if(inbox.video[1].length > 0){
                                          html += '<div class="attach-vid">'
                                              html += ' <div class="edit-vid">'
                                                  html += ' <svg class="dot-vid-brown vid-brown-'+inbox._id+'" aria-label="Unsend"  fill="#8e8e8e" height="16" role="img" viewBox="0 0 48 48" width="16">'
                                                      html += ' <circle clip-rule="evenodd" cx="8" cy="24" fill-rule="evenodd" r="4.5">'
                                                      html += '</circle>'
                                                      html += '<circle clip-rule="evenodd" cx="24" cy="24" fill-rule="evenodd" r="4.5">'
                                                      html += '</circle>'
                                                      html += '<circle clip-rule="evenodd" cx="40" cy="24" fill-rule="evenodd" r="4.5">'
                                                      html += '</circle>'
                                                  html += ' </svg>'
                                                  html += '<svg class="dot-vid-black vid-black-'+inbox._id+'" aria-label="Unsend"  fill="#262626" height="16" role="img" viewBox="0 0 48 48" width="16">'
                                                      html += ' <circle clip-rule="evenodd" cx="8" cy="24" fill-rule="evenodd" r="4.5">'
                                                      html += '</circle>'
                                                      html += '<circle clip-rule="evenodd" cx="24" cy="24" fill-rule="evenodd" r="4.5">'
                                                      html += '</circle>'
                                                      html += ' <circle clip-rule="evenodd" cx="40" cy="24" fill-rule="evenodd" r="4.5">'
                                                      html += '</circle>'
                                                  html += ' </svg>'
                                                  html += '<div class="modal-edit-vid modal-vid-'+inbox._id+'">'
                                                    var islike_vid_receiver = false
                                                    var id_created_vid_receiver = ''
                                                    if(inbox.video[0].length > 0){
                                                      for(var i =0 ; i < inbox.video[0].length;i++){
                                                        var likeVideo = inbox.video[0]
                                                        if(likeVideo[i].from.toString() == user._id.toString()){
                                                            islike_vid_receiver = true
                                                            id_created_vid_receiver = likeVideo[i].createdAt
                                                            break;
                                                        }
                                                      }
                                                    }
                                                    if(islike_vid_receiver){
                                                      html += '<p class="unlike-vid" onclick="like_Msg('+"'"+"video"+"'"+","+"'"+inbox._id+"'"+","+"'"+id+"'"+","+"'"+inbox.createdAt+"'"+","+"'"+id_created_vid_receiver+"'"+')">'
                                                          html += 'Unlike&nbsp;'
                                                      html += '</p>'
                                                      html += '<p onclick="unsend_Msg('+"'"+"video"+"'"+","+"'"+inbox._id+"'"+","+"'"+id+"'"+","+"'"+inbox.createdAt+"'"+')">Unsend'
                                                      html += '</p>'
                                                      html += '<img class="vid-unlike" src="img/tamgiac.png" alt="">'
                                                    }
                                                    else{
                                                      html += '<p class="unlike-vid-0" onclick="like_Msg('+"'"+"video"+"'"+","+"'"+inbox._id+"'"+","+"'"+id+"'"+","+"'"+inbox.createdAt+"'"+')">'
                                                        html += 'Like'
                                                      html += '</p>'
                                                      html += '<p onclick="unsend_Msg('+"'"+"video"+"'"+","+"'"+inbox._id+"'"+","+"'"+id+"'"+","+"'"+inbox.createdAt+"'"+')">Unsend'
                                                      html += '</p>'
                                                      html += '<img class="vid-like" src="img/tamgiac.png" alt="">'
                                                    }
                                                
                                                  html += '</div>'
                                              html += '</div>'
                                              for(var n =0 ; n < inbox.video[1].length; n++){
                                                var video = inbox.video[1]
                                                  html += '<a href="demo/' + video[n].originalname + '" class="video-msg">'
                                                      html += '<iframe src="/demo/' + video[n].originalname + '" frameborder="0" sandbox>'
                                                      html += '</iframe>'
                                                      if(inbox.video[0].length > 0){
                                                          if(inbox.video[0].length > 1){
                                                            html += ' <div style="visibility:visible" class="heart-vid heart-vid-'+inbox._id+'">'
                                                              html += '<span style="color:#333">'
                                                                html += inbox.video[0].length 
                                                              html += '</span>'
                                                              html += '<span>'
                                                              html += '❤️</span>'
                                                            html += '</div>'
                                                          }else{
                                                            for(var i =0 ; i < inbox.video[0].length;i++){
                                                                var likeVideo = inbox.video[0]
                                                                if(likeVideo[i].from.toString() == user._id.toString()){
                                                                  html += ' <div style="visibility:visible" class="heart-vid heart-vid-'+inbox._id+'">'
                                                                    html += '❤️'
                                                                  html += '</div>'
                                                                }else{
                                                                  html += ' <div style="visibility:visible" class="heart-vid heart-vid-'+inbox._id+'">'
                                                                    html += '	&#128153'
                                                                  html += '</div>'
                                                                }
                                                            }
                                                            
                                                          }
                                                        }
                                                  
                                                  html += '  </a>'
                                              }
                                          html += '</div>'
                                      }
                                        if(inbox.message){
                                            html += '<div class="content-msg">'
                                              html += '<div class="edit-msg">'
                                                  html += '<svg class="dot-msg-brown msg-brown-'+inbox._id+'" aria-label="Unsend"  fill="#8e8e8e" height="16" role="img" viewBox="0 0 48 48" width="16">'
                                                      html += '<circle clip-rule="evenodd" cx="8" cy="24" fill-rule="evenodd" r="4.5">'
                                                      html += '</circle>'
                                                      html += '<circle clip-rule="evenodd" cx="24" cy="24" fill-rule="evenodd" r="4.5">'
                                                      html += '</circle>'
                                                      html += '<circle clip-rule="evenodd" cx="40" cy="24" fill-rule="evenodd" r="4.5">'
                                                      html += '</circle>'
                                                  html += '</svg>'
                                                  html += '<svg class="dot-msg-black msg-black-'+inbox._id+'" aria-label="Unsend"  fill="#262626" height="16" role="img" viewBox="0 0 48 48" width="16">'
                                                      html += '<circle clip-rule="evenodd" cx="8" cy="24" fill-rule="evenodd" r="4.5">'
                                                      html += '</circle>'
                                                      html += '<circle clip-rule="evenodd" cx="24" cy="24" fill-rule="evenodd" r="4.5">'
                                                      html += '</circle>'
                                                      html += '<circle clip-rule="evenodd" cx="40" cy="24" fill-rule="evenodd" r="4.5">' 
                                                      html += '</circle>'
                                                  html += '</svg>'   
                                                  html += '<div class="modal-edit-msg modal-msg-'+inbox._id+'">'
                                                  
                                                  // check like message
                                                  var islike_msg_receiver = false
                                                  var id_created_msg_receiver  = ''
                                                  if(inbox.likes.length > 0){
                                                    for(var i =0 ; i < inbox.likes.length;i++){
                                                      if(inbox.likes[i].from.toString() == user._id.toString()){
                                                          islike_msg_receiver = true
                                                          id_created_msg_receiver = inbox.likes[i].createdAt
                                                          break;
                                                      }
                                                    }
                                                  }
                                                  if(islike_msg_receiver){
                                                    html += '<p class="unlike-msg" onclick="like_Msg('+"'"+"message"+"'"+","+"'"+inbox._id+"'"+","+"'"+id+"'"+","+"'"+inbox.createdAt+"'"+","+"'"+id_created_msg_receiver+"'"+')">'
                                                        html += 'Unlike&nbsp;'
                                                    html += '</p>'
                                                    html += '<p onclick="unsend_Msg('+"'"+"message"+"'"+","+"'"+inbox._id+"'"+","+"'"+id+"'"+","+"'"+inbox.createdAt+"'"+')">Unsend'
                                                    html += '</p>'
                                                    html += '<img class="msg-unlike" src="img/tamgiac.png" alt="">'
                                                  }
                                                  else{
                                                    html += '<p class="unlike-msg-0" onclick="like_Msg('+"'"+"message"+"'"+","+"'"+inbox._id+"'"+","+"'"+id+"'"+","+"'"+inbox.createdAt+"'"+')">'
                                                    html += 'Like'
                                                    html += '</p>'
                                                    html += '<p onclick="unsend_Msg('+"'"+"message"+"'"+","+"'"+inbox._id+"'"+","+"'"+id+"'"+","+"'"+inbox.createdAt+"'"+')">Unsend'
                                                    html += '</p>'
                                                    html += '<img class="msg-like" src="img/tamgiac.png" alt="">'
                                                  }

                                                  html += '</div>'                             
                                              html += '</div>'
                                              html += '<div class="text-msg">'
                                                  html += inbox.message
                                                  if(inbox.likes.length > 0){
                                                      if(inbox.likes.length > 1){
                                                        html += ' <div style="visibility:visible" class="heart-msg heart-msg-'+inbox._id+'">'
                                                          html += '<span>'
                                                            html += inbox.likes.length 
                                                          html += '</span>'
                                                          html += '<span>'
                                                          html += '❤️</span>'
                                                        html += '</div>'
                                                      }else{
                                                        for(var i =0 ; i < inbox.likes.length;i++){
                                                            if(inbox.likes[i].from.toString() == user._id.toString()){
                                                              html += ' <div style="visibility:visible" class="heart-msg heart-msg-'+inbox._id+'">'
                                                                html += '❤️'
                                                              html += '</div>'
                                                            }else{
                                                              html += ' <div style="visibility:visible" class="heart-msg heart-msg-'+inbox._id+'">'
                                                                html += '	&#128153'
                                                              html += '</div>'
                                                            }
                                                        }
                                                        
                                                      }
                                                     
                                                  }
                                                  
                                              html += '</div>'
                                          html += '</div>'
                                        }   
                                    html += '</div>'
                                  html += '</div>'
                              }
                              else
                              {
                                html += '<div class="sender" id="sender-'+inbox._id+'">'
                                  html += '<div class="box-msg">'

                                    if(inbox.image[1].length > 0){
                                        html += '<div class="attach-img">'
                                            html += '<div class="edit-img">'
                                                html += '<svg class="dot-img-brown img-brown-'+inbox._id+'" aria-label="Unsend"  fill="#8e8e8e" height="16" role="img" viewBox="0 0 48 48" width="16">'
                                                    html += '<circle clip-rule="evenodd" cx="8" cy="24" fill-rule="evenodd" r="4.5">'
                                                    html += '</circle>'
                                                    html += '<circle clip-rule="evenodd" cx="24" cy="24" fill-rule="evenodd" r="4.5">'
                                                    html += '</circle>'
                                                    html += '<circle clip-rule="evenodd" cx="40" cy="24" fill-rule="evenodd" r="4.5">'
                                                    html += '</circle>'
                                                    html += '</svg>'
                                                html += '<svg class="dot-img-black img-black-'+inbox._id+'" aria-label="Unsend"  fill="#262626" height="16" role="img" viewBox="0 0 48 48" width="16">'
                                                    html += '<circle clip-rule="evenodd" cx="8" cy="24" fill-rule="evenodd" r="4.5">'
                                                    html += '</circle>'
                                                    html += '<circle clip-rule="evenodd" cx="24" cy="24" fill-rule="evenodd" r="4.5">'
                                                    html += '</circle>'
                                                    html += '<circle clip-rule="evenodd" cx="40" cy="24" fill-rule="evenodd" r="4.5">'
                                                    html += '</circle>'
                                                html += '</svg>'
                                            html += '<div class="modal-edit-img modal-img-'+inbox._id+'">'
                                                    var islike_img_sender = false
                                                    var id_created_img_sender = ''
                                                    if(inbox.image[0].length > 0){
                                                      for(var i =0 ; i < inbox.image[0].length;i++){
                                                        var likeImage = inbox.image[0]
                                                        if(likeImage[i].from.toString() == user._id.toString()){
                                                            islike_img_sender = true
                                                            id_created_img_sender = likeImage[i].createdAt
                                                            break;
                                                        }
                                                      }
                                                    }
                                                    if(islike_img_sender){
                                                      html += '<p class="unlike-img" onclick="like_Msg('+"'"+"image"+"'"+","+"'"+inbox._id+"'"+","+"'"+id+"'"+","+"'"+inbox.createdAt+"'"+","+"'"+id_created_img_sender+"'"+')">'
                                                          html += 'Unlike&nbsp;'
                                                      html += '</p>'
                                                      html += '<p onclick="unsend_Msg('+"'"+"image"+"'"+","+"'"+inbox._id+"'"+","+"'"+id+"'"+","+"'"+inbox.createdAt+"'"+')">Unsend'
                                                      html += '</p>'
                                                      html += '<img class="img-unlike" src="img/tamgiac.png" alt="">'
                                                    }
                                                    else{
                                                      html += '<p class="unlike-img-0" onclick="like_Msg('+"'"+"image"+"'"+","+"'"+inbox._id+"'"+","+"'"+id+"'"+","+"'"+inbox.createdAt+"'"+')">'
                                                          html += 'Like'
                                                      html += '</p>'
                                                      html += '<p onclick="unsend_Msg('+"'"+"image"+"'"+","+"'"+inbox._id+"'"+","+"'"+id+"'"+","+"'"+inbox.createdAt+"'"+')">Unsend'
                                                      html += '</p>'
                                                      html += '<img class="img-like" src="img/tamgiac.png" alt="">'
                                                    }
                                                
                                            html += '</div>'
                                        html += '</div>'
                                          html += '<div class="img-msg">'
                                              html += '<div class="inner-width">'
                                                  html += '<div class="gallery">'
                                                    for(var n =0 ; n < inbox.image[1].length; n++){
                                                      var image = inbox.image[1]
                                                      html += '<a href="/demo/' + image[n].originalname + ' " class="image">'
                                                        html += '<img src="/demo/' + image[n].originalname + ' " alt="">'
                                                      html += '</a>'
                                                    }  
                                                  html += '</div>'
                                              html += '</div>'
                                              if(inbox.image[0].length > 0){
                                                if(inbox.image[0].length > 1){
                                                  html += ' <div style="visibility:visible" class="heart-img heart-img-'+inbox._id+'">'
                                                    html += '<span>'
                                                      html += inbox.image[0].length 
                                                    html += '</span>'
                                                    html += '<span>'
                                                    html += '❤️</span>'
                                                  html += '</div>'
                                                }else{
                                                  for(var i =0 ; i < inbox.image[0].length;i++){
                                                      var likeImage = inbox.image[0]
                                                      if(likeImage[i].from.toString() == user._id.toString()){
                                                        html += ' <div style="visibility:visible" class="heart-img heart-img-'+inbox._id+'">'
                                                          html += '❤️'
                                                        html += '</div>'
                                                      }else{
                                                        html += ' <div style="visibility:visible" class="heart-img heart-img-'+inbox._id+'">'
                                                          html += '	&#128153'
                                                        html += '</div>'
                                                      }
                                                  }
                                                  
                                                }
                                                     
                                              }
                                                
                                          html += '</div>'
                                      html += '</div>'
                                    }

                                    if(inbox.video[1].length > 0){
                                            html += '<div class="attach-vid">'
                                              html += ' <div class="edit-vid">'
                                                for(var n =0 ; n < inbox.video[1].length; n++){
                                                  var video =  inbox.video[1]
                                                  html += '<a href="demo/' + video[n].originalname + '" class="video-msg">'
                                                      html += ' <iframe src="/demo/' + video[n].originalname + '" frameborder="0" sandbox>'
                                                      html += '</iframe>'
                                                      if(inbox.video[0].length > 0){
                                                          if(inbox.video[0].length > 1){
                                                            html += ' <div style="visibility:visible" class="heart-vid heart-vid-'+inbox._id+'">'
                                                              html += '<span style="color:#333">'
                                                                html += inbox.video[0].length 
                                                              html += '</span>'
                                                              html += '<span>'
                                                              html += '❤️</span>'
                                                            html += '</div>'
                                                          }else{
                                                            for(var i =0 ; i < inbox.video[0].length;i++){
                                                                var likeVideo = inbox.video[0]
                                                                if(likeVideo[i].from.toString() == user._id.toString()){
                                                                  html += ' <div style="visibility:visible" class="heart-vid heart-vid-'+inbox._id+'">'
                                                                    html += '❤️'
                                                                  html += '</div>'
                                                                }else{
                                                                  html += ' <div style="visibility:visible" class="heart-vid heart-vid-'+inbox._id+'">'
                                                                    html += '	&#128153'
                                                                  html += '</div>'
                                                                }
                                                            }
                                                            
                                                          }
                                                        }
                                                  
                                                  html += '  </a>'
                                                }
                                                  html += ' <svg class="dot-vid-brown vid-brown-'+inbox._id+'" aria-label="Unsend"  fill="#8e8e8e" height="16" role="img" viewBox="0 0 48 48" width="16">'
                                                      html += ' <circle clip-rule="evenodd" cx="8" cy="24" fill-rule="evenodd" r="4.5">'
                                                      html += '</circle>'
                                                      html += '<circle clip-rule="evenodd" cx="24" cy="24" fill-rule="evenodd" r="4.5">'
                                                      html += '</circle>'
                                                      html += '<circle clip-rule="evenodd" cx="40" cy="24" fill-rule="evenodd" r="4.5">'
                                                      html += '</circle>'
                                                  html += ' </svg>'
                                                  html += '<svg class="dot-vid-black vid-black-'+inbox._id+'" aria-label="Unsend"  fill="#262626" height="16" role="img" viewBox="0 0 48 48" width="16">'
                                                      html += ' <circle clip-rule="evenodd" cx="8" cy="24" fill-rule="evenodd" r="4.5">'
                                                      html += '</circle>'
                                                      html += '<circle clip-rule="evenodd" cx="24" cy="24" fill-rule="evenodd" r="4.5">'
                                                      html += '</circle>'
                                                      html += ' <circle clip-rule="evenodd" cx="40" cy="24" fill-rule="evenodd" r="4.5">'
                                                      html += '</circle>'
                                                  html += ' </svg>'
                                                  html += '<div class="modal-edit-vid modal-vid-'+inbox._id+'">'
                                                    var islike_vid_sender = false
                                                    var id_created_vid_sender = ''
                                                    if(inbox.video[0].length > 0){
                                                      for(var i =0 ; i < inbox.video[0].length;i++){
                                                        var likeVideo = inbox.video[0]
                                                        if(likeVideo[i].from.toString() == user._id.toString()){
                                                            islike_vid_sender = true
                                                            id_created_vid_sender = likeVideo[i].createdAt
                                                            break;
                                                        }
                                                      }
                                                    }
                                                    if(islike_vid_sender){
                                                      html += '<p class="unlike-vid" onclick="like_Msg('+"'"+"video"+"'"+","+"'"+inbox._id+"'"+","+"'"+id+"'"+","+"'"+inbox.createdAt+"'"+","+"'"+id_created_vid_sender+"'"+')">'
                                                          html += 'Unlike&nbsp;'
                                                      html += '</p>'
                                                      html += '<p onclick="unsend_Msg('+"'"+"video"+"'"+","+"'"+inbox._id+"'"+","+"'"+id+"'"+","+"'"+inbox.createdAt+"'"+')">Unsend'
                                                      html += '</p>'
                                                      html += '<img class="vid-unlike" src="img/tamgiac.png" alt="">'
                                                    }
                                                    else{
                                                      html += '<p class="unlike-vid-0" onclick="like_Msg('+"'"+"video"+"'"+","+"'"+inbox._id+"'"+","+"'"+id+"'"+","+"'"+inbox.createdAt+"'"+')">'
                                                        html += 'Like'
                                                      html += '</p>'
                                                      html += '<p onclick="unsend_Msg('+"'"+"video"+"'"+","+"'"+inbox._id+"'"+","+"'"+id+"'"+","+"'"+inbox.createdAt+"'"+')">Unsend'
                                                      html += '</p>'
                                                      html += '<img class="vid-like" src="img/tamgiac.png" alt="">'
                                                    }
                                                  html += '</div>'
                                              html += '</div>'
                                          html += '</div>'
                                      }
                                    
                                    if(inbox.message){
                                    html += '<div class="content-msg">'
                                        html += '<div class="text-msg">'
                                            html += inbox.message
                                            if(inbox.likes.length > 0){
                                                if(inbox.likes.length > 1){
                                                  html += ' <div style="visibility:visible" class="heart-msg heart-msg-'+inbox._id+'">'
                                                    html += '<span>'
                                                      html += inbox.likes.length 
                                                    html += '</span>'
                                                    html += '<span>'
                                                    html += '❤️</span>'
                                                  html += '</div>'
                                                }else{
                                                  for(var i =0 ; i < inbox.likes.length;i++){
                                                      if(inbox.likes[i].from.toString() == user._id.toString()){
                                                        html += ' <div style="visibility:visible" class="heart-msg heart-msg-'+inbox._id+'">'
                                                          html += '❤️'
                                                        html += '</div>'
                                                      }else{
                                                        html += ' <div style="visibility:visible" class="heart-msg heart-msg-'+inbox._id+'">'
                                                          html += '	&#128153'
                                                        html += '</div>'
                                                      }
                                                  }
                                                  
                                                }
                                                
                                            }
                                        html += '</div>'
                                        html += '<div class="edit-msg">'
                                            html += '<svg class="dot-msg-brown msg-brown-'+inbox._id+'" aria-label="Unsend"  fill="#8e8e8e" height="16" role="img" viewBox="0 0 48 48" width="16">'
                                                html += '<circle clip-rule="evenodd" cx="8" cy="24" fill-rule="evenodd" r="4.5">'
                                                html += '</circle>'
                                                html += '<circle clip-rule="evenodd" cx="24" cy="24" fill-rule="evenodd" r="4.5">'
                                                html += '</circle>'
                                                html += '<circle clip-rule="evenodd" cx="40" cy="24" fill-rule="evenodd" r="4.5">'
                                                html += '</circle>'
                                            html += '</svg>'
                                            html += '<svg class="dot-msg-black msg-black-'+inbox._id+'" aria-label="Unsend"  fill="#262626" height="16" role="img" viewBox="0 0 48 48" width="16">'
                                                html += '<circle clip-rule="evenodd" cx="8" cy="24" fill-rule="evenodd" r="4.5">'
                                                html += '</circle>'
                                                html += '<circle clip-rule="evenodd" cx="24" cy="24" fill-rule="evenodd" r="4.5">'
                                                html += '</circle>'
                                                html += '<circle clip-rule="evenodd" cx="40" cy="24" fill-rule="evenodd" r="4.5">' 
                                                html += '</circle>'
                                            html += '</svg>'   
                                            html += '<div class="modal-edit-msg modal-msg-'+inbox._id+'">'
                                                // check like message
                                                  var islike_msg_sender = false
                                                  var id_created_msg_sender = ''
                                                  if(inbox.likes.length > 0){
                                                    for(var i =0 ; i < inbox.likes.length;i++){
                                                      if(inbox.likes[i].from.toString() == user._id.toString()){
                                                        islike_msg_sender = true
                                                        id_created_msg_sender = inbox.likes[i].createdAt
                                                          break;
                                                      }
                                                    }
                                                  }
                                                  if(islike_msg_sender){
                                                    html += '<p class="unlike-msg" onclick="like_Msg('+"'"+"message"+"'"+","+"'"+inbox._id+"'"+","+"'"+id+"'"+","+"'"+inbox.createdAt+"'"+","+"'"+id_created_msg_sender+"'"+')">'
                                                        html += 'Unlike&nbsp;'
                                                    html += '</p>'
                                                    html += '<p onclick="unsend_Msg('+"'"+"message"+"'"+","+"'"+inbox._id+"'"+","+"'"+id+"'"+","+"'"+inbox.createdAt+"'"+')">Unsend'
                                                    html += '</p>'
                                                    html += '<img class="msg-unlike" src="img/tamgiac.png" alt="">'
                                                  }else{
                                                    html += '<p class="unlike-msg-0" onclick="like_Msg('+"'"+"message"+"'"+","+"'"+inbox._id+"'"+","+"'"+id+"'"+","+"'"+inbox.createdAt+"'"+')">'
                                                    html += 'Like'
                                                    html += '</p>'
                                                    html += '<p onclick="unsend_Msg('+"'"+"message"+"'"+","+"'"+inbox._id+"'"+","+"'"+id+"'"+","+"'"+inbox.createdAt+"'"+')">Unsend'
                                                    html += '</p>'
                                                    html += '<img class="msg-like" src="img/tamgiac.png" alt="">'
                                                  }
                                            html += '</div>'                             
                                        html += '</div>'
                                    html += '</div>'
                                  }
                                    
                                  html += '</div>'
                                html += '</div>'
                              }
                              hoverReceiver(inbox._id);
                            }
                      }
                   
                    }
                    var chat = document.getElementsByClassName("frame-chat")[0]
                    chat.innerHTML=html
                    chat.scrollTop=chat.scrollHeight;
                   

                    $('.receiver').hover(function() {
                      var a = this.id
                      a=a.split("receiver-")[1]
                      hoverReceiver(a)
	                  });
                    $('.sender').hover(function() {
                      var a = this.id
                      a=a.split("sender-")[1]
                      hoverSender(a);
                    })
                   
                    
                    
                }
            }
        })
  
  }

  function like_Msg(format,id_mes,id_follow,id_createdAt,id_created){
    $.ajax({
          method: "POST",
          url: "/likeChat",
          data: {
              format:format,
              id_mes:id_mes,
              id_follow:id_follow,
              id_createdAt:id_createdAt,
              id_created:id_created
          },
          cache: false,
          success: function(responseText) {
              if (responseText.status == "success") {
                getMessage(id_follow)
              }
          },
          error:function(responseText) {
              alert(responseText)
          }
        });
  }

  function unsend_Msg(format,id_mes){
      
  }

  socket.on("messageReceiver",(msg)=>{
    var html = ""
      if(msg.from){
        html += '<div class="receiver" id="receiver-'+msg.createdAt+'">'
          html += '<div class="box-msg">'
            if(msg.image.length > 0){
                  html += '<div class="attach-img">'
                      html += '<div class="edit-img">'
                          html += '<svg class="dot-img-brown img-brown-'+msg.createdAt+'" aria-label="Unsend"  fill="#8e8e8e" height="16" role="img" viewBox="0 0 48 48" width="16">'
                              html += '<circle clip-rule="evenodd" cx="8" cy="24" fill-rule="evenodd" r="4.5">'
                              html += '</circle>'
                              html += '<circle clip-rule="evenodd" cx="24" cy="24" fill-rule="evenodd" r="4.5">'
                              html += '</circle>'
                              html += '<circle clip-rule="evenodd" cx="40" cy="24" fill-rule="evenodd" r="4.5">'
                              html += '</circle>'
                              html += '</svg>'
                          html += '<svg class="dot-img-black img-black-'+msg.createdAt+'" aria-label="Unsend"  fill="#262626" height="16" role="img" viewBox="0 0 48 48" width="16">'
                              html += '<circle clip-rule="evenodd" cx="8" cy="24" fill-rule="evenodd" r="4.5">'
                              html += '</circle>'
                              html += '<circle clip-rule="evenodd" cx="24" cy="24" fill-rule="evenodd" r="4.5">'
                              html += '</circle>'
                              html += '<circle clip-rule="evenodd" cx="40" cy="24" fill-rule="evenodd" r="4.5">'
                              html += '</circle>'
                          html += '</svg>'
                      html += '<div class="modal-edit-img modal-img-'+msg.createdAt+'">'
                          html += '<p>Like'
                          html += '</p>'
                          html += '<p>Unsend'
                          html += '</p>'
                          html += '<img src="img/tamgiac.png" alt="">'
                      html += '</div>'
                  html += '</div>'
                  html += '<div class="img-msg">'
                      html += '<div class="inner-width">'
                          html += '<div class="gallery">'
                            for(var i = 0; i < msg.image.length;i++){
                              html += '<a href="demo/' +  msg.image[i].originalname + '" class="image" >'
                                  html += '<img src="/demo/' +  msg.image[i].originalname + '" alt="">'
                              html += '</a>'
                            }
                          html += '</div>'
                      html += '</div>'
                      html += '<div class="heart-img heart-img-'+msg.createdAt+'">'
                          html += '❤️'
                      html += '</div>'
                  html += '</div>'
              html += '</div>'
            }
            if(msg.video.length > 0){
                  html += '<div class="attach-vid">'
                  html += ' <div class="edit-vid">'
                      html += ' <svg class="dot-vid-brown vid-brown-'+msg.createdAt+'" aria-label="Unsend"  fill="#8e8e8e" height="16" role="img" viewBox="0 0 48 48" width="16">'
                          html += ' <circle clip-rule="evenodd" cx="8" cy="24" fill-rule="evenodd" r="4.5">'
                          html += '</circle>'
                          html += '<circle clip-rule="evenodd" cx="24" cy="24" fill-rule="evenodd" r="4.5">'
                          html += '</circle>'
                          html += '<circle clip-rule="evenodd" cx="40" cy="24" fill-rule="evenodd" r="4.5">'
                          html += '</circle>'
                      html += ' </svg>'
                      html += '<svg class="dot-vid-black vid-black-'+msg.createdAt+'" aria-label="Unsend"  fill="#262626" height="16" role="img" viewBox="0 0 48 48" width="16">'
                          html += ' <circle clip-rule="evenodd" cx="8" cy="24" fill-rule="evenodd" r="4.5">'
                          html += '</circle>'
                          html += '<circle clip-rule="evenodd" cx="24" cy="24" fill-rule="evenodd" r="4.5">'
                          html += '</circle>'
                          html += ' <circle clip-rule="evenodd" cx="40" cy="24" fill-rule="evenodd" r="4.5">'
                          html += '</circle>'
                      html += ' </svg>'
                      html += '<div class="modal-edit-vid modal-vid-'+msg.createdAt+'">'
                          html += '<p>Like'
                          html += '</p>'
                          html += '<p>Unsend'
                          html += '</p>'
                          html += ' <img src="img/tamgiac.png" alt="">'
                      html += '</div>'
                  html += '</div>'
                  for(var i = 0;i < msg.video.length;i++){
                      html += '<a href="demo/' +  msg.video[i].originalname + '" class="video-msg">'
                        html += ' <iframe src="/demo/' +  msg.video[i].originalname + '" frameborder="0" sandbox>'
                        html += '</iframe>'
                        html += '  <div class="heart-vid">'
                            html += '  ❤️'
                        html += ' </div>'
                      html += '  </a>'
                  }
                  
              html += '</div>'
            }
            if(msg.message){
              html += '<div class="content-msg">'
                html += '<div class="edit-msg">'
                    html += '<svg class="dot-msg-brown msg-brown-'+msg.createdAt+'" aria-label="Unsend"  fill="#8e8e8e" height="16" role="img" viewBox="0 0 48 48" width="16">'
                        html += '<circle clip-rule="evenodd" cx="8" cy="24" fill-rule="evenodd" r="4.5">'
                        html += '</circle>'
                        html += '<circle clip-rule="evenodd" cx="24" cy="24" fill-rule="evenodd" r="4.5">'
                        html += '</circle>'
                        html += '<circle clip-rule="evenodd" cx="40" cy="24" fill-rule="evenodd" r="4.5">'
                        html += '</circle>'
                    html += '</svg>'
                    html += '<svg class="dot-msg-black msg-black-'+msg.createdAt+'" aria-label="Unsend"  fill="#262626" height="16" role="img" viewBox="0 0 48 48" width="16">'
                        html += '<circle clip-rule="evenodd" cx="8" cy="24" fill-rule="evenodd" r="4.5">'
                        html += '</circle>'
                        html += '<circle clip-rule="evenodd" cx="24" cy="24" fill-rule="evenodd" r="4.5">'
                        html += '</circle>'
                        html += '<circle clip-rule="evenodd" cx="40" cy="24" fill-rule="evenodd" r="4.5">' 
                        html += '</circle>'
                    html += '</svg>'   
                    html += '<div class="modal-edit-msg modal-msg-'+msg.createdAt+'">'
                        html += '<p>Like'
                        html += '</p>'
                        html += '<p>Unsend'
                        html += '</p>'
                        html += '<img src="img/tamgiac.png" alt="">'
                    html += '</div>'                             
                html += '</div>'
                html += '<div class="text-msg">'
                    html += msg.message
                    html += ' <div class="heart-msg heart-msg-'+msg.createdAt+'">'
                        html += '❤️'
                    html += '</div>'
                html += '</div>'
            html += '</div>'
            }
                    
          html += '</div>'
      html += '</div>'
      }
      if(msg.to){
        html += '<div class="sender" id="sender-'+msg.createdAt+'">'
            html += '<div class="box-msg">'
              if(msg.image.length > 0){
                      html += '<div class="attach-img">'
                          html += '<div class="edit-img">'
                            html += '<div class="img-msg">'
                          html += '<div class="inner-width">'
                              html += '<div class="gallery">'
                                for(var i = 0; i<msg.image.length;i++){
                                  html += '<a href="demo/' +  msg.image[i].originalname + '" class="image">'
                                      html += '<img src="/demo/' +  msg.image[i].originalname + '" alt="">'
                                  html += '</a>'
                                }
                              html += '</div>'
                          html += '</div>'
                          html += '<div class="heart-img heart-img-'+msg.createdAt+'">'
                              html += '❤️'
                          html += '</div>'
                      html += '</div>'
                      html += '<svg class="dot-img-brown img-brown-'+msg.createdAt+'" aria-label="Unsend"  fill="#8e8e8e" height="16" role="img" viewBox="0 0 48 48" width="16">'
                          html += '<circle clip-rule="evenodd" cx="8" cy="24" fill-rule="evenodd" r="4.5">'
                          html += '</circle>'
                          html += '<circle clip-rule="evenodd" cx="24" cy="24" fill-rule="evenodd" r="4.5">'
                          html += '</circle>'
                          html += '<circle clip-rule="evenodd" cx="40" cy="24" fill-rule="evenodd" r="4.5">'
                          html += '</circle>'
                          html += '</svg>'
                      html += '<svg class="dot-img-black img-black-'+msg.createdAt+'" aria-label="Unsend"  fill="#262626" height="16" role="img" viewBox="0 0 48 48" width="16">'
                          html += '<circle clip-rule="evenodd" cx="8" cy="24" fill-rule="evenodd" r="4.5">'
                          html += '</circle>'
                          html += '<circle clip-rule="evenodd" cx="24" cy="24" fill-rule="evenodd" r="4.5">'
                          html += '</circle>'
                          html += '<circle clip-rule="evenodd" cx="40" cy="24" fill-rule="evenodd" r="4.5">'
                          html += '</circle>'
                      html += '</svg>'
                      html += '<div class="modal-edit-img modal-img-'+msg.createdAt+'">'
                          html += '<p>Like'
                          html += '</p>'
                          html += '<p>Unsend'
                          html += '</p>'
                          html += '<img src="img/tamgiac.png" alt="">'
                      html += '</div>'
                  html += '</div>'
              html += '</div>'
           }
              if(msg.video.length > 0){
                html += '<div class="attach-vid">'
                    html += ' <div class="edit-vid">'
                      for(var i =0 ; i<msg.video.length;i++ ){
                        html += '<a href="demo/' +  msg.video[i].originalname + '" class="video-msg">'
                            html += ' <iframe src="/demo/' +  msg.video[i].originalname + '" frameborder="0" sandbox>'
                            html += '</iframe>'
                            html += '  <div class="heart-vid heart-vid-'+msg.createdAt+'">'
                                html += '  ❤️'
                            html += ' </div>'
                        html += '  </a>'
                      }
                        html += ' <svg class="dot-vid-brown vid-brown-'+msg.createdAt+'" aria-label="Unsend"  fill="#8e8e8e" height="16" role="img" viewBox="0 0 48 48" width="16">'
                            html += ' <circle clip-rule="evenodd" cx="8" cy="24" fill-rule="evenodd" r="4.5">'
                            html += '</circle>'
                            html += '<circle clip-rule="evenodd" cx="24" cy="24" fill-rule="evenodd" r="4.5">'
                            html += '</circle>'
                            html += '<circle clip-rule="evenodd" cx="40" cy="24" fill-rule="evenodd" r="4.5">'
                            html += '</circle>'
                        html += ' </svg>'
                        html += '<svg class="dot-vid-black vid-black-'+msg.createdAt+'" aria-label="Unsend"  fill="#262626" height="16" role="img" viewBox="0 0 48 48" width="16">'
                            html += ' <circle clip-rule="evenodd" cx="8" cy="24" fill-rule="evenodd" r="4.5">'
                            html += '</circle>'
                            html += '<circle clip-rule="evenodd" cx="24" cy="24" fill-rule="evenodd" r="4.5">'
                            html += '</circle>'
                            html += ' <circle clip-rule="evenodd" cx="40" cy="24" fill-rule="evenodd" r="4.5">'
                            html += '</circle>'
                        html += ' </svg>'
                        html += '<div class="modal-edit-vid modal-vid-'+msg.createdAt+'">'
                            html += '<p>Like'
                            html += '</p>'
                            html += '<p>Unsend'
                            html += '</p>'
                            html += ' <img src="img/tamgiac.png" alt="">'
                        html += '</div>'
                    html += '</div>'
                html += '</div>'
              }
              if(msg.message){
                  html += '<div class="content-msg">'
                    html += '<div class="text-msg">'
                        html += msg.message
                        html += ' <div class="heart-msg heart-msg-'+msg.createdAt+'">'
                            html += '❤️'
                        html += '</div>'
                    html += '</div>'
                    html += '<div class="edit-msg">'
                        html += '<svg class="dot-msg-brown msg-brown-'+msg.createdAt+'" aria-label="Unsend"  fill="#8e8e8e" height="16" role="img" viewBox="0 0 48 48" width="16">'
                            html += '<circle clip-rule="evenodd" cx="8" cy="24" fill-rule="evenodd" r="4.5">'
                            html += '</circle>'
                            html += '<circle clip-rule="evenodd" cx="24" cy="24" fill-rule="evenodd" r="4.5">'
                            html += '</circle>'
                            html += '<circle clip-rule="evenodd" cx="40" cy="24" fill-rule="evenodd" r="4.5">'
                            html += '</circle>'
                        html += '</svg>'
                        html += '<svg class="dot-msg-black msg-black-'+msg.createdAt+'" aria-label="Unsend"  fill="#262626" height="16" role="img" viewBox="0 0 48 48" width="16">'
                            html += '<circle clip-rule="evenodd" cx="8" cy="24" fill-rule="evenodd" r="4.5">'
                            html += '</circle>'
                            html += '<circle clip-rule="evenodd" cx="24" cy="24" fill-rule="evenodd" r="4.5">'
                            html += '</circle>'
                            html += '<circle clip-rule="evenodd" cx="40" cy="24" fill-rule="evenodd" r="4.5">' 
                            html += '</circle>'
                        html += '</svg>'   
                        html += '<div class="modal-edit-msg modal-msg-'+msg.createdAt+'">'
                            html += '<p>Like'
                            html += '</p>'
                            html += '<p>Unsend'
                            html += '</p>'
                            html += '<img src="img/tamgiac.png" alt="">'
                        html += '</div>'                             
                    html += '</div>'
                html += '</div>'
              }    
            html += '</div>'
        html += '</div>'
      }  
      var chat = $(".frame-chat")
      chat.append(html)
      var c = document.getElementsByClassName("frame-chat")[0]
      c.scrollTop=c.scrollHeight;
      hoverReceiver(msg.createdAt);
      hoverSender(msg.createdAt);
  })

  function resetVariable_Msg(){
    stored_img = [];
    arr_img = ''
    html_msg = ""
    stored_vid = []
    arr_vid = ''
    vid_msg = ""
  }

  function sendMessageFriends(form){
      var ajax = new XMLHttpRequest();
      ajax.open("POST", "/sendMessageFriends", true);

      ajax.onreadystatechange = function () {
          if (this.readyState == 4 && this.status == 200) {
              var response = JSON.parse(this.responseText);
              if (response.status == "success") {
                  $(".image").css('display', 'none')
                  document.getElementById("post-message").querySelector("input[name='message']").value = "";
                  resetVariable_Msg();
                  form.reset();
              }
              else {
                  alert(response.error)
              }

          }

      };

      var formData = new FormData(form);
      if(stored_img.length > 0){  
          formData.delete('image')
          for(var i=0, len=stored_img.length; i<len; i++) {
            formData.append('image', stored_img[i]);	
          }
      }
      if(stored_vid.length > 0){  
          formData.delete('video')
          for(var i=0, len=stored_vid.length; i<len; i++) {
            formData.append('video', stored_vid[i]);	
          }
      }
    
      ajax.send(formData);

      return false;
  }

</script>

<%- include ("../shares/footer") %>