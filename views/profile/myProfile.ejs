<%- include ("../shares/header") %>


    <div class="container Pro">

        <div class="inforFile">
            <div class="testimonial">
                <figure class="inforFile-image">
                    <% if(userCurrent=="" ){%>
                        <img class="imaProfile testimonial__img" id="photo" src='<%=image%>' alt="hyun">
                        <label class="testimonial__caption" for="file" id="label-upload">
                            Change photo
                        </label>
                        <input name="profileImage" type="file" class=" upload-photo" id="file" accept="image/*"
                            onchange="uploadImage();">
                        <%}else{%>
                            <img class="imaProfile " id="photo" src='<%=per.profileImage%>' alt="hyun">
                            <%}%>
                </figure>
            </div>

            <div class="inforFile-user-settings">

                <h1 class="inforFile-user-name">
                    <%=fullname%>
                </h1>

                <% if(userCurrent!="" ){%>
                    <% if(follower.length> 0) {%>
                        <% follower.forEach(function(follow) {%>
                            <% if(follow.idFollower==userCurrent._id){ %>
                                <a href="" style="background-color:#fff;color:#333;border: 0.5px solid #DBDBDB;"
                                    class="btn inforFile-edit-btn" id="btFollow-<%=per._id%>"
                                    onclick="btnFollow('this','<%=per._id%>','wordImg')">
                                    Unfollow
                                </a>
                                <%}else{%>
                                    <a href="" style="background-color:#0095F6;color:#fff"
                                        class="btn inforFile-edit-btn" id="btFollow-<%=per._id%>"
                                        onclick="btnFollow('this','<%=per._id%>','wordImg')">
                                        Follow
                                    </a>
                                    <%}%>
                                        <%})%>
                                            <%}else{%>
                                                <a href="" style="background-color:#0095F6;color:#fff"
                                                    class="btn inforFile-edit-btn" id="btFollow-<%=per._id%>"
                                                    onclick="btnFollow('this','<%=per._id%>','wordImg')">
                                                    Follow
                                                </a>
                                                <%}%>
                                                    <%}else{%>
                                                        <a href="/myProfile/editProfile" class="btn inforFile-edit-btn"
                                                            id="btEdit">Edit Profile</a>
                                                        <%}%>

            </div>

            <!-- infor follow -->
            <div class="inforFile-stats">

                <ul>
                    <li>
                        <% if(post.length==0 || post.length==1){%>
                            <span class="inforFile-stat-count" id="amount-post">
                                <%=post.length%>
                            </span> post
                            <%}else{%>
                                <span class="inforFile-stat-count" id="amount-post">
                                    <%=post.length%>
                                </span> posts
                                <%}%>
                    </li>

                    <li>
                        <% if(follower.length==0 || follower.length==1){%>
                            <span class="inforFile-stat-count">
                                <%=follower.length%>
                            </span> follower
                            <%}else{%>
                                <span class="inforFile-stat-count" id="amount-post">
                                    <%=follower.length%>
                                </span> followers
                                <%}%>
                    </li>

                    <li>
                        <% if(following.length==0 || following.length==1){%>
                            <span class="inforFile-stat-count">
                                <%=following.length%>
                            </span>following
                            <%}else{%>
                                <span class="inforFile-stat-count" id="amount-post">
                                    <%=following.length%>
                                </span> followings
                                <%}%>
                    </li>
                </ul>

            </div>

            <!-- infor personal -->
            <div class="inforFile-bio">
                <p>
                    <span class="inforFile-real-name">
                        <%=name%>
                    </span>
                    <br>
                    <%=bio%>
                </p>

            </div>
        </div>
        <!-- End of profile section -->
        <hr id="zop">
        <div class="feature">
            <a class="" onclick="display_MyPost()" tabindex="0">
                <svg aria-label="Posts" fill="#262626" height="12" viewBox="0 0 48 48" width="12">
                    <path clip-rule="evenodd"
                        d="M45 1.5H3c-.8 0-1.5.7-1.5 1.5v42c0 .8.7 1.5 1.5 1.5h42c.8 0 1.5-.7 1.5-1.5V3c0-.8-.7-1.5-1.5-1.5zm-40.5 3h11v11h-11v-11zm0 14h11v11h-11v-11zm11 25h-11v-11h11v11zm14 0h-11v-11h11v11zm0-14h-11v-11h11v11zm0-14h-11v-11h11v11zm14 28h-11v-11h11v11zm0-14h-11v-11h11v11zm0-14h-11v-11h11v11z"
                        fill-rule="evenodd"></path>
                </svg>
                <span class="">Posts</span>
            </a>
            <a class="" onclick="display_savePost()" tabindex="0">
                <svg aria-label="Saved" fill="#262626" height="12" viewBox="0 0 48 48" width="12">
                    <path
                        d="M43.5 48c-.4 0-.8-.2-1.1-.4L24 29 5.6 47.6c-.4.4-1.1.6-1.6.3-.6-.2-1-.8-1-1.4v-45C3 .7 3.7 0 4.5 0h39c.8 0 1.5.7 1.5 1.5v45c0 .6-.4 1.2-.9 1.4-.2.1-.4.1-.6.1zM24 26c.8 0 1.6.3 2.2.9l15.8 16V3H6v39.9l15.8-16c.6-.6 1.4-.9 2.2-.9z">
                    </path>
                </svg>
                <span class="">Saved</span>
            </a>
        </div>
    </div>


    <!-- <div class="container gallery">
        <div class="gallery-content">
            <div class="gallery-img">
                <a href="/img/1.png">
                    <img src="/img/1.png" class="card-img-top" alt="">
                     <div class="gallery-item-info">
                        <ul>
                            <li style="margin-left:-2rem" class="gallery-item-likes"><span
                                    class="visually-hidden">Likes:</span>
                                <i class="fas fa-heart" aria-hidden="true"></i> <%=like%>
                            </li>
                            <li style="padding-left: 1em;" class="gallery-item-comments"><span
                                    class="visually-hidden">Comments:</span>
                                1 <i class="fas fa-comment" aria-hidden="true"></i> </li>
                        </ul>

                    </div> 
                </a>
            

            </div>
            <div class="gallery-img">
                <a href="/img/1.png">
                    <img src="/img/1.png" class="card-img-top" alt="">
                     <div class="gallery-item-info">
                        <ul>
                            <li style="margin-left:-2rem" class="gallery-item-likes"><span
                                    class="visually-hidden">Likes:</span>
                                <i class="fas fa-heart" aria-hidden="true"></i> <%=like%>
                            </li>
                            <li style="padding-left: 1em;" class="gallery-item-comments"><span
                                    class="visually-hidden">Comments:</span>
                                1 <i class="fas fa-comment" aria-hidden="true"></i> </li>
                        </ul>

                    </div> 
                </a>
            

            </div>

        </div>


    </div> -->

    <div class="container gallery" id="gallery-profile-mypost">
        <div class="gallery-content"></div>
        <div id="page-post"></div>
    </div>
    <div class="container gallery" id="gallery-profile-savepost" style="display: none;">
            <div class="gallery-content"></div>
            <div id="page-post-save"></div>
    </div>

    </div>



    <div class="loader"></div>
    <script src="/js/pagination.js"> </script>
    <script>
        $('#page-post').pagination({
            dataSource: '/getPagePost',
            totalNumberLocator: function (response) {
                if(response.page_size ==  response.total){
                    return response.total-1
                }else{
                    return response.total
                }
                
            },
            locator: 'data',
            pageSize: 2,
            afterPageOnClick: function (event, pageNumber) {
                loadPage(pageNumber)
            },
            afterNextOnClick:function(event,pageNumber){
                loadPage(pageNumber)
            },
            afterPreviousOnClick:function(event,pageNumber){
                loadPage(pageNumber)
            }
        })

        $('#page-post-save').pagination({
            dataSource: '/getPagePost/save/',
            totalNumberLocator: function (response) {
                if(response.page_size ==  response.total){
                    return response.total-1
                }else{
                    return response.total
                }
            },
            locator: 'data',
            pageSize: 2,
            afterPageOnClick: function (event, pageNumber) {
                loadPageSave(pageNumber)
            },
            afterNextOnClick:function(event,pageNumber){
                loadPageSave(pageNumber)
            },
            afterPreviousOnClick:function(event,pageNumber){
                loadPageSave(pageNumber)
            }
        })

        function loadPage(page) {
            $("#gallery-profile-mypost .gallery-content").html('')
            $.ajax({
                method: "POST",
                url: '/getPagePost/' + page,
                cache: false,
                success: function (responseText) {
                    var post = responseText.data
                    var item = ''
                    for (var i = 0; i < post.length; i++) {
                        var pos = post[i]
                        item += ' <div class="viewport-gallery gallery-img">'

                        item += ' <ul class="list-img-gallery" id="list-img-gallery-'+pos._id+'>">'
                        for(var j =0 ; j < pos.image.length ; j++){
                            item += '<li class="item-gallery">'
                                item += ' <img src="/demo/'+pos.image[j].originalname+'"   alt="">'
                            item += ' </li>'
                        }
                        
                        for(var j =0 ; j < pos.video.length ; j++){
                            item += ' <li class="item-gallery">'
                                item += '<iframe width="280" height="300" src="/demo/'+pos.video[j].originalname+'" frameborder="0" allowfullscreen sandbox>'
                                item += ' </iframe>'
                            item += ' </li>'
                        }

                        if(pos.image == "" && pos.video == "") {
                            item += '  <li class="item-gallery" style="border: 2px solid #EFEFEF ;">'
                                item += ' <p style="position: relative;top: 6rem ;left: 6rem;">'
                                    item += post.caption.split(" ")[0] + '...'
                                item += ' </p>'
                            item += '</li>'
                        }
                        

                        item += ' </ul>'
                        item += ' <div class="gallery-item-info" onclick="modalComment(this, '+pos._id+' )">'
                        item += ' <ul style="display: flex;">'
                        item += '  <li class="gallery-item-likes">'
                        item += ' <i class="fas fa-heart" aria-hidden="true">'
                            item += pos.likers.length
                        item += '</i>'
                        item += '</li>'

                        item += '<li class="gallery-item-comments">'
                        item += '<i class="fas fa-comment">'
                            var a=0
                            for(var j = 0; j < pos.comments.length; j++){
                                a += pos.comments[j].replies.length
                            }
                            item += a + pos.comments.length
                        item += '</i>'
                        item += '</li>'

                        item += ' </ul>'
                        item += ' </div>'
                        item += ' <div class="cover-btn-gallery" >'
                        if(pos.image.length >1){
                            item += ' <i class="fas fa-chevron-circle-right next-gal" id="next-gal-'+pos._id+'" onclick="slideGallery('+"right"+','+"'"+pos.image.length+"'"+','+"'"+pos._id+"'"+')" >'
                            item += '</i>'
                            item += ' <i class="fas fa-chevron-circle-left prev-gal"  id="prev-gal-'+pos._id+'" onclick="slideGallery('+"left"+','+"'"+pos.image.length+"'"+','+"'"+pos._id+"'"+')">'
                            item += '  </i>'
                        }else if (pos.video.length >1){
                            item += '  <i class="fas fa-chevron-circle-right next-gal" id="next-gal-'+pos._id+'" onclick="slideGallery('+"right"+','+"'"+pos.image.length+"'"+','+"'"+pos._id+"'"+')" >'
                            item += '  </i>'
                            item += '   <i class="fas fa-chevron-circle-left prev-gal"  id="prev-gal-'+pos._id+'" onclick="slideGallery('+"left"+','+"'"+pos.image.length+"'"+','+"'"+pos._id+"'"+')">'
                            item += '   </i>'
                        }else if ((pos.video.length+pos.image.length) >1){
                            item += '   <i class="fas fa-chevron-circle-right next-gal" id="next-gal-'+pos._id+'" onclick="slideGallery('+"right"+','+"'"+pos.image.length+"'"+','+"'"+pos._id+"'"+')" >'
                            item += '  </i>'
                            item += '  <i class="fas fa-chevron-circle-left prev-gal"  id="prev-gal-'+pos._id+'" onclick="slideGallery('+"left"+','+"'"+pos.image.length+"'"+','+"'"+pos._id+"'"+')">'
                            item += '  </i>'
                        }
                        item += '</div>'
                    item += '  </div>'
                    }
                    $("#gallery-profile-mypost .gallery-content").append(item)
                   
                }
            })
        }

        loadPage(1)
      
        function loadPageSave(page) {
            $("#gallery-profile-savepost .gallery-content").html('')
            $.ajax({
                method: "POST",
                url: '/getPagePost/save/' + page,
                cache: false,
                success: function (responseText) {
                    var post = responseText.data
                    var item = ''
                    for (var i = 0; i < post.length; i++) {
                        var pos = post[i]
                        item += ' <div class="viewport-gallery gallery-img">'

                        item += ' <ul class="list-img-gallery" id="list-img-gallery-'+pos._id+'>">'
                        for(var j =0 ; j < pos.image.length ; j++){
                            item += '<li class="item-gallery">'
                                item += ' <img src="/demo/'+pos.image[j].originalname+'"   alt="">'
                            item += ' </li>'
                        }
                        
                        for(var j =0 ; j < pos.video.length ; j++){
                            item += ' <li class="item-gallery">'
                                item += '<iframe width="280" height="300" src="/demo/'+pos.video[j].originalname+'" frameborder="0" allowfullscreen sandbox>'
                                item += ' </iframe>'
                            item += ' </li>'
                        }

                        if(pos.image == "" && pos.video == "") {
                            item += '  <li class="item-gallery" style="border: 2px solid #EFEFEF ;">'
                                item += ' <p style="position: relative;top: 6rem ;left: 6rem;">'
                                    item += post.caption.split(" ")[0] + '...'
                                item += ' </p>'
                            item += '</li>'
                        }
                        

                        item += ' </ul>'
                        item += ' <div class="gallery-item-info" onclick="modalComment(this, '+"'"+pos._id+"'"+' )">'
                        item += ' <ul style="display: flex;">'
                        item += '  <li class="gallery-item-likes">'
                        item += ' <i class="fas fa-heart" aria-hidden="true">'
                            item += pos.likers.length
                        item += '</i>'
                        item += '</li>'

                        item += '<li class="gallery-item-comments">'
                        item += '<i class="fas fa-comment">'
                            var a=0
                            for(var j = 0; j < pos.comments.length; j++){
                                a += pos.comments[j].replies.length
                            }
                            item += a + pos.comments.length
                        item += '</i>'
                        item += '</li>'

                        item += ' </ul>'
                        item += ' </div>'
                        item += ' <div class="cover-btn-gallery" >'
                        if(pos.image.length >1){
                            item += ' <i class="fas fa-chevron-circle-right next-gal" id="next-gal-'+pos._id+'" onclick="slideGallery('+"right"+','+"'"+pos.image.length+"'"+','+"'"+pos._id+"'"+')" >'
                            item += '</i>'
                            item += ' <i class="fas fa-chevron-circle-left prev-gal"  id="prev-gal-'+pos._id+'" onclick="slideGallery('+"left"+','+"'"+pos.image.length+"'"+','+"'"+pos._id+"'"+')">'
                            item += '  </i>'
                        }else if (pos.video.length >1){
                            item += '  <i class="fas fa-chevron-circle-right next-gal" id="next-gal-'+pos._id+'" onclick="slideGallery('+"right"+','+"'"+pos.image.length+"'"+','+"'"+pos._id+"'"+')" >'
                            item += '  </i>'
                            item += '   <i class="fas fa-chevron-circle-left prev-gal"  id="prev-gal-'+pos._id+'" onclick="slideGallery('+"left"+','+"'"+pos.image.length+"'"+','+"'"+pos._id+"'"+')">'
                            item += '   </i>'
                        }else if ((pos.video.length+pos.image.length) >1){
                            item += '   <i class="fas fa-chevron-circle-right next-gal" id="next-gal-'+pos._id+'" onclick="slideGallery('+"right"+','+"'"+pos.image.length+"'"+','+"'"+pos._id+"'"+')" >'
                            item += '  </i>'
                            item += '  <i class="fas fa-chevron-circle-left prev-gal"  id="prev-gal-'+pos._id+'" onclick="slideGallery('+"left"+','+"'"+pos.image.length+"'"+','+"'"+pos._id+"'"+')">'
                            item += '  </i>'
                        }
                        item += '</div>'
                    item += '  </div>'
                    }
                    $("#gallery-profile-savepost .gallery-content").append(item)
                   
                }
            })
        }

        loadPageSave(1)

        function display_MyPost() {
            $("#gallery-profile-savepost").css("display", "none")
            $("#gallery-profile-mypost").css("display", "block")
        }

        function display_savePost() {
            $("#gallery-profile-mypost").css("display", "none")
            $("#gallery-profile-savepost").css("display", "block")
        }



        function slideGallery(direction, size, id) {
            var container = document.getElementById('list-img-gallery-' + id);
            var x;
            var x1;
            var temp;
            scrollCompleted = 0;
            var slideVar = setInterval(function () {
                if (size > 1) {
                    if (direction == "right") {
                        container.scrollLeft += 29;
                        x = container.scrollLeft
                        if (x == (size * 290) - 290) {
                            $('#next-gal-' + id).css("opacity", "0")
                        } else {
                            $('#prev-gal-' + id).css("opacity", "0.8")
                            $('#next-gal-' + id).css("opacity", "0.8")
                        }
                    }
                    if (direction == "left") {
                        container.scrollLeft -= 29;
                        x1 = container.scrollLeft
                        if (x1 == 0) {
                            $('#prev-gal-' + id).css("opacity", "0")
                        } else {
                            $('#prev-gal-' + id).css("opacity", "0.8")
                            $('#next-gal-' + id).css("opacity", "0.8")
                        }

                    }
                    scrollCompleted += 10;
                    if (scrollCompleted >= 100) {
                        window.clearInterval(slideVar);
                    }
                }

            }, 30);

        }

    </script>

    <%- include ("../shares/footer") %>